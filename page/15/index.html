<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222"/>
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2"/>

<link rel="stylesheet" href="/css/main.css?v=7.1.1"/>


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.1.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="john's tech blog">
<meta property="og:url" content="http://yoursite.com/page/15/index.html">
<meta property="og:site_name" content="john's tech blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="john's tech blog">
<meta name="twitter:description">





  
  
  <link rel="canonical" href="http://yoursite.com/page/15/"/>



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>john's tech blog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">john's tech blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">hope is coming</h1>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br/>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br/>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br/>归档</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/31/scala-package/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="john's tech blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/03/31/scala-package/" class="post-title-link" itemprop="url">scala_package</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-03-31 15:29:23" itemprop="dateCreated datePublished" datetime="2017-03-31T15:29:23+08:00">2017-03-31</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-07 20:32:35" itemprop="dateModified" datetime="2019-05-07T20:32:35+08:00">2019-05-07</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="scala-打包子项目"><a href="#scala-打包子项目" class="headerlink" title="scala 打包子项目"></a>scala 打包子项目</h2><p>在idea中有多个项目时，我想单独打包子项目，搜了几篇文章受到了启发，  </p>
<p>只要在命令行中执行<code>sbt module-a/clean module-a/test</code>命令即可.  </p>
<p>其中 module-a 为定义在根项目中的变量.<br>比如：<br>lazy val <code>api</code> = (project in file(“api”)).settings(javadocSettings: _*).dependsOn(<code>common</code>, <code>bigdata</code>).aggregate(<code>common</code>, <code>bigdata</code>)</p>
<p><a href="http://stackoverflow.com/questions/18075820/how-to-execute-package-for-one-submodule-only-on-jenkins" target="_blank" rel="external">How to execute package for one submodule only on Jenkins?</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/31/scala-mock/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="john's tech blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/03/31/scala-mock/" class="post-title-link" itemprop="url">scala_mock</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-03-31 14:04:04" itemprop="dateCreated datePublished" datetime="2017-03-31T14:04:04+08:00">2017-03-31</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-07 20:32:35" itemprop="dateModified" datetime="2019-05-07T20:32:35+08:00">2019-05-07</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="scala-mock"><a href="#scala-mock" class="headerlink" title="scala mock"></a>scala mock</h2><p>读了这篇文章( Mock Objects for Scala and Android)[<a href="https://www.artima.com/scalazine/articles/borachio_mock_objects_for_scala.html],对scala" target="_blank" rel="external">https://www.artima.com/scalazine/articles/borachio_mock_objects_for_scala.html],对scala</a> mock有点了解了。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">trait Turtle &#123;</span><br><span class="line">  <span class="function">def <span class="title">penUp</span><span class="params">()</span></span><br><span class="line">  def <span class="title">penDown</span><span class="params">()</span></span><br><span class="line">  def <span class="title">forward</span><span class="params">(distance: Double)</span></span><br><span class="line">  def <span class="title">turn</span><span class="params">(angle: Double)</span></span><br><span class="line">  def getAngle: Double</span><br><span class="line">  def getPosition: <span class="params">(Double, Double)</span></span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>This API is not very convenient. We have no way to move to a specific position, instead we need to work out how to get from where we are now to where we want to get by calculating angles and distances. The diagram below, for example, demonstrates the movements a turtle starting at the origin (0, 0) would need to make to draw a line from (1, 1) to (2, 1).</p>
<p>Turtle diagram</p>
<p>You can see an example of code that performs these calculations here. This isn’t trivial, so we want to test to make sure that it’s doing the right thing. Here’s a test (written with ScalaTest) that creates a mock turtle that pretends to start at the origin (0, 0) and verifies that if we ask the code we’ve just written to draw a line from (1, 1) to (2, 1) it performs the correct sequence of turns and movements:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">class MockFunctionTest extends Suite with MockFactory &#123;</span><br><span class="line"></span><br><span class="line">  val mockTurtle = mock[Turtle]</span><br><span class="line">  val controller = new Controller(mockTurtle)</span><br><span class="line"></span><br><span class="line">  def testDrawLine() &#123;</span><br><span class="line">    inSequence &#123;</span><br><span class="line">      mockTurtle expects 'getPosition returning (0.0, 0.0)</span><br><span class="line">      mockTurtle expects 'getAngle returning 0.0</span><br><span class="line">      mockTurtle expects 'penUp</span><br><span class="line">      mockTurtle expects 'turn withArgs (~(Pi / 4))</span><br><span class="line">      mockTurtle expects 'forward withArgs (~sqrt(2.0))</span><br><span class="line">      mockTurtle expects 'getAngle returning Pi / 4</span><br><span class="line">      mockTurtle expects 'turn withArgs (~(-Pi / 4))</span><br><span class="line">      mockTurtle expects 'penDown</span><br><span class="line">      mockTurtle expects 'forward withArgs (1.0)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    controller.drawLine((1.0, 1.0), (2.0, 1.0))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/31/scala-abstract-override2/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="john's tech blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/03/31/scala-abstract-override2/" class="post-title-link" itemprop="url">scala_abstract_override2</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-03-31 10:21:25" itemprop="dateCreated datePublished" datetime="2017-03-31T10:21:25+08:00">2017-03-31</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-07 20:32:35" itemprop="dateModified" datetime="2019-05-07T20:32:35+08:00">2019-05-07</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="scala-abstract-override"><a href="#scala-abstract-override" class="headerlink" title="scala abstract override"></a>scala abstract override</h2><p>看到了<a href="http://www.artima.com/scalazine/articles/stackable_trait_pattern.html" target="_blank" rel="external">Scala’s Stackable Trait Pattern</a>这篇文章， 继续研究scala abstract override：</p>
<pre><code class="java">trait Base {
def foo
}

trait StackingTrait extends Base {
<span class="keyword">abstract</span> override def foo { println (<span class="string">"aa"</span>)}
}

<span class="class"><span class="keyword">class</span> <span class="title">ImplHelper</span> <span class="keyword">extends</span> <span class="title">Base</span> </span>{
def foo {}
}

<span class="class"><span class="keyword">class</span> <span class="title">Impl</span>   <span class="keyword">extends</span> <span class="title">Base</span></span>{
  def foo {
        println(<span class="string">"ss"</span>)
  }
}

val implInstance = <span class="keyword">new</span> Impl with StackingTrait

implInstance.foo
</code></pre>
<p>打印出来了aa  </p>
<p>This arrangement is frequently needed with traits that implement stackable modifications. To tell the compiler you are doing this on purpose, you must mark such methods as abstract override. This combination of modifiers is only allowed for members of traits, not classes, and it means that the trait must be mixed into some class that has a concrete definition of the method in question. </p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/31/scala-abscractoverride/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="john's tech blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/03/31/scala-abscractoverride/" class="post-title-link" itemprop="url">scala_abscractoverride</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-03-31 09:42:43" itemprop="dateCreated datePublished" datetime="2017-03-31T09:42:43+08:00">2017-03-31</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-07 20:32:35" itemprop="dateModified" datetime="2019-05-07T20:32:35+08:00">2019-05-07</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="abstract-override"><a href="#abstract-override" class="headerlink" title="abstract override"></a>abstract override</h2><p>前几天在看scalatra源码时，看到FileUploadExample这个实例类时，竟然提示我如下错误：  </p>
<p><code>error: class FileUploadExample needs to be a mixin, since method initialize in trait HasMultipartConfig of type =&gt; Unit is marked abstract and override</code>  </p>
<p>我在HasMultipartConfig中可以看到如下定义：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">abstract</span> override def <span class="title">initialize</span><span class="params">(config: ConfigT)</span> </span>&#123;</span><br><span class="line"> <span class="keyword">super</span>.initialize(config)</span><br><span class="line"></span><br><span class="line"> providedConfig foreach &#123; _ apply config.context &#125;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">这个initialize其实是定义在Initializable这个trait中的：  </span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">  trait Initializable &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * A hook to initialize the class with some configuration after it has</span><br><span class="line">     * been constructed.</span><br><span class="line">     *</span><br><span class="line">     * Not called init because GenericServlet doesn't override it, and then</span><br><span class="line">     * we get into https://lampsvn.epfl.ch/trac/scala/ticket/2497.</span><br><span class="line">     */</span></span><br><span class="line">      <span class="function">def <span class="title">initialize</span><span class="params">(config: ConfigT)</span></span><br><span class="line">  &#125;</span></span><br></pre></td></tr></table></figure>
<p>也就是说HasMultipartConfig 中abstract override了它，那么为什么会报错呢？搜索了相关资料，有如下答案：  </p>
<p>My understanding is that while the error message may be confusing, the behaviour is correct. foo is declared as abstract override in StackingTrait, and thus in any concrete class that mixes StackingTrait there must be a concrete (not marked as abstract) implementation of foo before StackingTrait (relative to the linearization order). This is because super refers to the trait just before in the linearization order, so there definitely needs to be a concrete implementation of foo before StackingTrait is mixed in, or super.foo would be nonsensical.</p>
<p>When you do this:  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Impl</span> <span class="keyword">extends</span> <span class="title">Base</span> <span class="title">with</span> <span class="title">StackingTrait</span> </span>&#123;</span><br><span class="line">  def foo &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>the linearization order is Base &lt;- StackingTrait &lt;- Impl. The only trait before StackingTrait is Base and Base does not define a concrete implementation of foo.</p>
<p>But when you do this:    </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">traitImplHelper extends Base &#123;</span><br><span class="line">  def foo &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Impl</span> <span class="keyword">extends</span> <span class="title">ImplHelper</span> <span class="title">with</span> <span class="title">StackingTrait</span></span></span><br></pre></td></tr></table></figure>
<p>参考资料：<br><a href="http://stackoverflow.com/questions/14169542/scala-trait-mixin-with-abstract-base-class" target="_blank" rel="external">Scala: Trait Mixin with Abstract Base Class</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/28/angular-decorator/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="john's tech blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/03/28/angular-decorator/" class="post-title-link" itemprop="url">angular_decorator</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-03-28 20:56:23" itemprop="dateCreated datePublished" datetime="2017-03-28T20:56:23+08:00">2017-03-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-07 20:32:35" itemprop="dateModified" datetime="2019-05-07T20:32:35+08:00">2019-05-07</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="angular-decorator装饰器"><a href="#angular-decorator装饰器" class="headerlink" title="angular decorator装饰器"></a>angular decorator装饰器</h2><p>先上段代码：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">angular.module(<span class="string">'myapp'</span>,[]).config(<span class="function"><span class="keyword">function</span>(<span class="params">$provide</span>)</span>&#123;</span><br><span class="line">      $provide.decorator(<span class="string">'$log'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$delegate</span>)</span>&#123;</span><br><span class="line">        angular.foreach([<span class="string">'log'</span>,<span class="string">'debug'</span>,<span class="string">'info'</span>,<span class="string">'warn'</span>,<span class="string">'error'</span>],<span class="function"><span class="keyword">function</span>(<span class="params">o</span>)</span>&#123;</span><br><span class="line">                      $delegate[o] = decoratorLogger($delegate[o]);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">decoratorLogger</span>(<span class="params">orignalFn</span>)</span>&#123;</span><br><span class="line">                      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                          <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.slice.apply(<span class="built_in">arguments</span>);</span><br><span class="line">                          args.unshift(<span class="keyword">new</span> <span class="built_in">Date</span>().toISPString());</span><br><span class="line">                          originalFn.apply(<span class="literal">null</span>,args);</span><br><span class="line">                      &#125;;</span><br><span class="line">                  &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">  &#125;);  </span><br><span class="line"><span class="string">``</span><span class="string">`  </span><br><span class="line"></span><br><span class="line">config方法之前也分析过,定义如下：  </span><br><span class="line">`</span><span class="string">``</span>js</span><br><span class="line"><span class="comment">/*</span><br><span class="line">      返回一个方法</span><br><span class="line">       方法内部调用configBlocks['push'](['$injector','invoke',arguments])</span><br><span class="line">       然后返回moduleInstance</span><br><span class="line"></span><br><span class="line">       config就是一个返回moduleInstance的函数</span><br><span class="line">     */</span></span><br><span class="line">     <span class="keyword">var</span> config = invokeLater(<span class="string">'$injector'</span>, <span class="string">'invoke'</span>, <span class="string">'push'</span>, configBlocks);</span><br><span class="line"></span><br><span class="line">     <span class="comment">/**</span><br><span class="line">        * @param &#123;string&#125; provider</span><br><span class="line">        * @param &#123;string&#125; method</span><br><span class="line">        * @param &#123;String=&#125; insertMethod</span><br><span class="line">        * @returns &#123;angular.Module&#125;</span><br><span class="line">        */</span></span><br><span class="line">       <span class="function"><span class="keyword">function</span> <span class="title">invokeLater</span>(<span class="params">provider, method, insertMethod, queue</span>) </span>&#123;</span><br><span class="line">         <span class="keyword">if</span> (!queue) queue = invokeQueue;</span><br><span class="line">         <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">           queue[insertMethod || <span class="string">'push'</span>]([provider, method, <span class="built_in">arguments</span>]);</span><br><span class="line">           <span class="keyword">return</span> moduleInstance;</span><br><span class="line">         &#125;;</span><br><span class="line">       &#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span><br><span class="line"></span><br><span class="line">decorator方法定义如下：  </span><br><span class="line"></span><br><span class="line">`</span><span class="string">``</span>js</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decorator</span>(<span class="params">serviceName, decorFn</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">var</span> origProvider = providerInjector.get(serviceName + providerSuffix),</span><br><span class="line">     orig$<span class="keyword">get</span> = origProvider.$<span class="keyword">get</span>;//是个字符串和函数的数组</span><br><span class="line"></span><br><span class="line"> origProvider.$<span class="keyword">get</span> = function() &#123; <span class="comment">//相当于重新定义了原来的$get方法</span></span><br><span class="line">   <span class="keyword">var</span> origInstance = instanceInjector.invoke(orig$<span class="keyword">get</span>, origProvider);</span><br><span class="line">   return instanceInjector.invoke(decorFn, null, &#123;$delegate: origInstance&#125;);</span><br><span class="line"> &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span><br><span class="line"></span><br><span class="line">$log是在`</span>angularModule(<span class="string">'ng'</span>, [<span class="string">'ngLocale'</span>], [<span class="string">'$provide'</span>, <span class="function"><span class="keyword">function</span> <span class="title">ngModule</span>(<span class="params">$provide</span>) </span>&#123;&#125;])<span class="string">`中配置进去的</span><br><span class="line"></span><br><span class="line">`</span><span class="string">``</span>js</span><br><span class="line">  $provide.provider(&#123;</span><br><span class="line">     <span class="attr">$log</span>: $LogProvider,</span><br><span class="line">  &#125;)</span><br><span class="line"><span class="string">``</span><span class="string">`  </span><br><span class="line"></span><br><span class="line">$LogProvider在line 13900,定义如下：</span><br><span class="line">`</span><span class="string">``</span>js</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">$LogProvider</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> debug = <span class="literal">true</span>,</span><br><span class="line">    self = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">this</span>.$<span class="keyword">get</span> = ['$window', function($window) &#123;&#125;]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>最终都是调用instanceInjector的getService方法获取<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">protoInstanceInjector =</span><br><span class="line">          createInternalInjector(instanceCache, <span class="function"><span class="keyword">function</span>(<span class="params">serviceName, caller</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//去providerCache里去找</span></span><br><span class="line">            <span class="keyword">var</span> provider = providerInjector.get(serviceName + providerSuffix, caller);</span><br><span class="line">            <span class="keyword">return</span> instanceInjector.invoke(</span><br><span class="line">                provider.$<span class="keyword">get</span>, provider, undefined, serviceName);</span><br><span class="line">            //$<span class="keyword">get</span> 各个provider定义的$<span class="keyword">get</span> 方法</span><br><span class="line">          &#125;)</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/14/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><span class="page-number current">15</span><a class="page-number" href="/page/16/">16</a><span class="space">&hellip;</span><a class="page-number" href="/page/34/">34</a><a class="extend next" rel="next" href="/page/16/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">John</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">170</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">27</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.2.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.1.1</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.1"></script>

  <script src="/js/motion.js?v=7.1.1"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.1.1"></script>




  

  


  <script src="/js/next-boot.js?v=7.1.1"></script>


  

  

  

  



  




  

  

  

  

  

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


  

  

  

  

  

  

  

  

</body>
</html>
